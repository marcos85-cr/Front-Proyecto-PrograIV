<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-title>
      <div class="header-content">
        <span class="greeting">Hola,</span>
        <span class="user-name">{{ userName() }}</span>
      </div>
    </ion-title>
    <ion-avatar slot="end" routerLink="/customer/profile" class="avatar-btn">
      <ion-icon name="person"></ion-icon>
    </ion-avatar>
  </ion-toolbar>
</ion-header>

<ion-content class="bank-gradient-bg">
  <ion-refresher slot="fixed" (ionRefresh)="refreshDashboard($event)">
    <ion-refresher-content pullingIcon="chevron-down-circle-outline" refreshingSpinner="crescent">
    </ion-refresher-content>
  </ion-refresher>

  <div class="dashboard-container">

    @if (isLoading()) {
    <div class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
    } @else {

    <!-- Balance Card -->
    <div class="balance-card">
      <span class="balance-label">Balance Total</span>
      <div class="balance-amounts">
        @if (totalBalance().CRC > 0) {
        <span class="balance-value">{{ formatCurrency(totalBalance().CRC, 'CRC') }}</span>
        }
        @if (totalBalance().USD > 0) {
        <span class="balance-value secondary">{{ formatCurrency(totalBalance().USD, 'USD') }}</span>
        }
        @if (totalBalance().CRC === 0 && totalBalance().USD === 0) {
        <span class="balance-value">₡0.00</span>
        }
      </div>
      <span class="accounts-count">{{ accounts().length }} cuenta(s) activa(s)</span>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      @for (action of quickActions; track action.route) {
      <button class="action-btn" [routerLink]="action.route">
        <ion-icon [name]="action.icon"></ion-icon>
        <span>{{ action.label }}</span>
      </button>
      }
    </div>

    <!-- Accounts Section -->
    @if (accounts().length > 0) {
    <div class="section">
      <div class="section-header">
        <h3>Mis Cuentas</h3>
        <ion-button fill="clear" size="small" routerLink="/customer/cuentas">
          Ver todas
        </ion-button>
      </div>
      <div class="accounts-list">
        @for (account of accounts().slice(0, 3); track account.id) {
        <div class="account-item">
          <div class="account-info">
            <span class="account-type">{{ account.tipo }}</span>
            <span class="account-number">•••• {{ account.numero.slice(-4) }}</span>
          </div>
          <div class="account-balance">
            <span class="amount">{{ formatCurrency(account.saldo, account.moneda) }}</span>
            <ion-chip [color]="account.estado === 'Activa' ? 'success' : 'warning'" size="small">
              {{ account.estado }}
            </ion-chip>
          </div>
        </div>
        }
      </div>
    </div>
    }

    <!-- Recent Transactions -->
    <div class="section">
      <div class="section-header">
        <h3>Movimientos Recientes</h3>
        <ion-button fill="clear" size="small" routerLink="/customer/transferencias">
          Ver todos
        </ion-button>
      </div>

      @if (recentTransactions().length > 0) {
      <div class="transactions-list">
        @for (tx of recentTransactions(); track tx.id) {
        <div class="transaction-item">
          <div class="tx-icon" [class.income]="isIncome(tx.tipo)">
            <ion-icon [name]="getTransactionIcon(tx.tipo)"></ion-icon>
          </div>
          <div class="tx-info">
            <span class="tx-desc">{{ tx.descripcion }}</span>
            <span class="tx-date">{{ formatDate(tx.fecha) }}</span>
          </div>
          <span class="tx-amount" [class.income]="isIncome(tx.tipo)">
            {{ isIncome(tx.tipo) ? '+' : '-' }}{{ formatCurrency(tx.monto > 0 ? tx.monto : -tx.monto) }}
          </span>
        </div>
        }
      </div>
      } @else {
      <div class="empty-state">
        <ion-icon name="receipt-outline"></ion-icon>
        <p>Sin movimientos recientes</p>
      </div>
      }
    </div>

    }
  </div>
</ion-content>
