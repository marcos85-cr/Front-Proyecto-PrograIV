<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Mi Resumen Financiero</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="bank-gradient-bg">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  @if (resumen() && !isLoading()) {
    <div class="bank-content-container">
      <!-- Patrimonio Total -->
      <div class="patrimony-card">
        <div class="bank-glass-card">
          <h3 class="patrimony-title">Patrimonio Total</h3>
          <div class="patrimony-grid">
            <div class="patrimony-item">
              <span class="currency-label">Colones (CRC)</span>
              <span class="patrimony-amount">{{ formatCurrency(resumen()?.patrimonioTotalCRC, 'CRC') }}</span>
            </div>
            <div class="patrimony-divider"></div>
            <div class="patrimony-item">
              <span class="currency-label">Dólares (USD)</span>
              <span class="patrimony-amount">{{ formatCurrency(resumen()?.patrimonioTotalUSD, 'USD') }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Cuentas -->
      <div class="bank-section">
        <div class="bank-section-header">
          <h3>Mis Cuentas</h3>
          <span class="bank-badge-primary">{{ resumen()?.cuentas?.length || 0 }}</span>
        </div>

        @if (resumen()?.cuentas && resumen()!.cuentas!.length > 0) {
          <div class="bank-simple-list">
            @for (cuenta of resumen()!.cuentas; track cuenta.id) {
              <div class="bank-glass-card account-item" (click)="goToCuenta(cuenta.id)">
                <div class="account-icon">
                  <ion-icon [name]="cuenta.tipo === 'Ahorro' ? 'wallet-outline' : 'card-outline'" color="primary"></ion-icon>
                </div>
                <div class="account-info">
                  <h4 class="account-number">****{{ cuenta.numero.slice(-4) }}</h4>
                  <p class="account-type">{{ cuenta.tipo }} - {{ cuenta.moneda }}</p>
                </div>
                <div class="account-balance">
                  <span class="balance-amount">{{ formatCurrency(cuenta.saldo, cuenta.moneda) }}</span>
                  <span class="balance-label">Disponible</span>
                </div>
                <div class="account-actions">
                  <ion-button fill="clear" size="small" (click)="goToExtracto(cuenta.id); $event.stopPropagation()">
                    <ion-icon name="document-text-outline" slot="icon-only"></ion-icon>
                  </ion-button>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Estadísticas del Mes -->
      <div class="bank-section">
        <div class="bank-section-header">
          <h3>Estadísticas del Mes</h3>
        </div>

        <div class="stats-card">
          <div class="stats-grid">
            <div class="stat-item">
              <ion-icon name="arrow-down-circle-outline" color="success"></ion-icon>
              <div class="stat-content">
                <span class="stat-label">Ingresos</span>
                <span class="stat-value success">{{ formatCurrency(resumen()?.ingresosMes) }}</span>
              </div>
            </div>
            <div class="stat-item">
              <ion-icon name="arrow-up-circle-outline" color="danger"></ion-icon>
              <div class="stat-content">
                <span class="stat-label">Gastos</span>
                <span class="stat-value danger">{{ formatCurrency(resumen()?.gastosMes) }}</span>
              </div>
            </div>
            <div class="stat-item">
              <ion-icon name="swap-horizontal-outline" color="primary"></ion-icon>
              <div class="stat-content">
                <span class="stat-label">Transferencias</span>
                <span class="stat-value">{{ resumen()?.transferenciasMes || 0 }}</span>
              </div>
            </div>
            <div class="stat-item">
              <ion-icon name="receipt-outline" color="warning"></ion-icon>
              <div class="stat-content">
                <span class="stat-label">Pagos</span>
                <span class="stat-value">{{ resumen()?.pagosMes || 0 }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Últimas Transacciones -->
      @if (resumen()?.ultimasTransacciones && resumen()!.ultimasTransacciones!.length > 0) {
        <div class="bank-section">
          <div class="bank-section-header">
            <h3>Últimas Transacciones</h3>
          </div>

          <div class="bank-simple-list">
            @for (trans of resumen()!.ultimasTransacciones; track trans.id) {
              <div class="bank-glass-card transaction-item">
                <div class="transaction-icon" [class]="trans.tipo === 'Credito' ? 'credit' : 'debit'">
                  <ion-icon [name]="trans.tipo === 'Credito' ? 'arrow-down-outline' : 'arrow-up-outline'"></ion-icon>
                </div>
                <div class="transaction-info">
                  <h4 class="transaction-desc">{{ trans.descripcion }}</h4>
                  <p class="transaction-date">{{ formatDate(trans.fecha) }}</p>
                </div>
                <span class="transaction-amount" [class]="trans.tipo === 'Credito' ? 'credit' : 'debit'">
                  {{ trans.tipo === 'Credito' ? '+' : '-' }}{{ formatCurrency(trans.monto, trans.moneda) }}
                </span>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }

  <!-- Cargando -->
  @if (isLoading()) {
    <div class="bank-loading-state">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p>Cargando resumen...</p>
    </div>
  }
</ion-content>
