<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Mi Resumen Financiero</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="bank-gradient-bg">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  @if (summary() && !isLoading()) {
    <div class="bank-content-container">
      <!-- Información del Cliente -->
      <div class="bank-section">
        <div class="bank-glass-card">
          <div class="customer-header">
            <div class="customer-avatar">
              <ion-icon name="person-circle-outline" color="primary"></ion-icon>
            </div>
            <div class="customer-info">
              <h2 class="customer-name">{{ summary()?.cliente?.nombre || 'Cliente' }}</h2>
              <p class="customer-id">ID: {{ summary()?.cliente?.identificacion || 'N/A' }}</p>
              <p class="customer-email">{{ summary()?.cliente?.correo || 'N/A' }}</p>
              <p class="customer-phone">{{ summary()?.cliente?.telefono || 'N/A' }}</p>
            </div>
          </div>
          <div class="customer-date">
            <span class="date-label">Cliente desde:</span>
            <span class="date-value">{{ formatDate(summary()?.cliente?.fechaRegistro) }}</span>
          </div>
        </div>
      </div>

      <!-- Patrimonio Total -->
      <div class="patrimony-card">
        <div class="bank-glass-card">
          <h3 class="patrimony-title">Patrimonio Total</h3>
          <div class="patrimony-grid">
            <div class="patrimony-item">
              <span class="currency-label">Colones (CRC)</span>
              <span class="patrimony-amount">{{ formatCurrency(summary()?.cuentas?.saldoTotalCRC, 'CRC') }}</span>
            </div>
            <div class="patrimony-divider"></div>
            <div class="patrimony-item">
              <span class="currency-label">Dólares (USD)</span>
              <span class="patrimony-amount">{{ formatCurrency(summary()?.cuentas?.saldoTotalUSD, 'USD') }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Resumen de Cuentas -->
      <div class="bank-section">
        <div class="bank-section-header">
          <h3>Mis Cuentas</h3>
          <div class="account-summary">
            <span class="bank-badge-primary">{{ summary()?.cuentas?.total || 0 }} totales</span>
            <span class="bank-badge-success">{{ summary()?.cuentas?.activas || 0 }} activas</span>
          </div>
        </div>

        @if (summary()?.cuentas?.detalle && summary()!.cuentas!.detalle!.length > 0) {
          <div class="bank-simple-list">
            @for (cuenta of summary()!.cuentas!.detalle; track cuenta.id) {
              <div class="bank-glass-card account-item" (click)="goToAccount(cuenta.id)">
                <div class="account-icon">
                  <ion-icon [name]="cuenta.tipo === 'Ahorro' ? 'wallet-outline' : 'card-outline'" color="primary"></ion-icon>
                </div>
                <div class="account-info">
                  <h4 class="account-number">****{{ cuenta.numero.slice(-4) }}</h4>
                  <p class="account-type">{{ cuenta.tipo }} - {{ cuenta.moneda }}</p>
                  <p class="account-status">Estado: {{ cuenta.estado }}</p>
                </div>
                <div class="account-balance">
                  <span class="balance-amount">{{ formatCurrency(cuenta.saldo, cuenta.moneda) }}</span>
                  <span class="balance-label">Disponible</span>
                </div>
                <div class="account-actions">
                  <ion-button fill="clear" size="small" (click)="goToStatement(cuenta.id); $event.stopPropagation()">
                    <ion-icon name="document-text-outline" slot="icon-only"></ion-icon>
                  </ion-button>
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Estadísticas de Actividad -->
      <div class="bank-section">
        <div class="bank-section-header">
          <h3>Estadísticas de Actividad</h3>
        </div>

        <div class="stats-card">
          <div class="stats-grid">
            <div class="stat-item">
              <ion-icon name="repeat-outline" color="primary"></ion-icon>
              <div class="stat-content">
                <span class="stat-label">Total Transacciones</span>
                <span class="stat-value">{{ summary()?.actividad?.totalTransacciones || 0 }}</span>
              </div>
            </div>
            <div class="stat-item">
              <ion-icon name="calendar-outline" color="success"></ion-icon>
              <div class="stat-content">
                <span class="stat-label">Transacciones del Mes</span>
                <span class="stat-value success">{{ summary()?.actividad?.transaccionesUltimoMes || 0 }}</span>
              </div>
            </div>
            <div class="stat-item">
              <ion-icon name="swap-horizontal-outline" color="warning"></ion-icon>
              <div class="stat-content">
                <span class="stat-label">Transferido del Mes</span>
                <span class="stat-value warning">{{ formatCurrency(summary()?.actividad?.montoTransferidoMes, 'CRC') }}</span>
              </div>
            </div>
            <div class="stat-item">
              <ion-icon name="time-outline" color="medium"></ion-icon>
              <div class="stat-content">
                <span class="stat-label">Última Transacción</span>
                <span class="stat-value">{{ formatDate(summary()?.actividad?.ultimaTransaccion) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Cargando -->
  @if (isLoading()) {
    <div class="bank-loading-state">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p>Cargando resumen...</p>
    </div>
  }
</ion-content>
