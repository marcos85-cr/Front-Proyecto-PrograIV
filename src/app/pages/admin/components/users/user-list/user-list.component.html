<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>Gestión de Usuarios</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="refreshUsers()">
        <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button (click)="goToCreateUser()">
        <ion-icon name="person-add-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="bank-gradient-bg">
  <!-- Búsqueda -->
  <div class="search-container">
    <ion-searchbar [(ngModel)]="searchTerm" placeholder="Buscar usuario por nombre" animated></ion-searchbar>

    <!-- Filtros de perfiles -->
    <div class="filters-container">
      <ion-segment [(ngModel)]="filterRole" class="profile-segment">
        <ion-segment-button value="todos">
          <ion-label>Todos</ion-label>
        </ion-segment-button>
        <ion-segment-button value="Administrador">
          <ion-label>Administrador</ion-label>
        </ion-segment-button>
        <ion-segment-button value="Gestor">
          <ion-label>Gestor</ion-label>
        </ion-segment-button>
        <ion-segment-button value="Cliente">
          <ion-label>Cliente</ion-label>
        </ion-segment-button>
      </ion-segment>
    </div>
  </div>

  <div class="bank-content-container">

    <!-- Estado de carga -->
    @if (isLoading) {
    <div class="bank-loading-section">
      <div class="bank-glass-card loading-card">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Cargando usuarios...</p>
      </div>
    </div>
    }

    <!-- Lista de Usuarios -->
    <div class="bank-section">
      <div class="bank-section-header">
        <h3>Usuarios Registrados</h3>
        <span class="bank-badge-primary">{{ filteredUsers.length }} usuarios</span>
      </div>
      @if (filteredUsers.length > 0) {
      <div class="bank-simple-list">
        @for (user of filteredUsers; track user.id) {
        <div class="bank-glass-card bank-customer-item" (click)="goToEditUser(user.id)">
          <div class="bank-customer-avatar">
            <img [src]="'https://ui-avatars.com/api/?name=' + user.nombre + '&background=random'" [alt]="user.nombre" />
          </div>
          <div class="bank-customer-info">
            <h4 class="bank-customer-name">{{ user.nombre }}</h4>
            <p class="bank-customer-email">{{ user.email }}</p>
            <div class="bank-customer-meta">
              <span class="bank-badge" [class.bank-badge-success]="!user.bloqueado" [class.bank-badge-danger]="user.bloqueado">
                {{ user.bloqueado ? 'Bloqueado' : 'Activo' }}
              </span>
              <span class="bank-text-small">{{ user.role }}</span>
            </div>
          </div>
        </div>
        }
      </div>
      }

      <!-- Sin Resultados -->
      @if (filteredUsers.length === 0 && !isLoading) {
      <div class="bank-empty-state">
        <div class="empty-content">
          <div class="empty-icon">
            <ion-icon name="search-outline"></ion-icon>
          </div>
          <h3>No se encontraron usuarios</h3>
          <p>Intenta ajustar los criterios de búsqueda</p>
          <ion-button fill="outline" (click)="searchTerm = '';" class="empty-action-btn">
            <ion-icon name="refresh-outline" slot="start"></ion-icon>
            Mostrar todos
          </ion-button>
        </div>
      </div>
      }

      <!-- Loading -->
      @if (isLoading) {
      <div class="bank-loading-state">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
        <p>Cargando usuarios...</p>
      </div>
      }

    </div>
  </div>
</ion-content>
