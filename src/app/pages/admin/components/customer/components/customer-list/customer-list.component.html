<ion-header class="ion-no-border">
    <ion-toolbar color="primary">
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/admin/dashboard"></ion-back-button>
        </ion-buttons>
        <ion-title>Gestión de Clientes</ion-title>
        <ion-buttons slot="end">
            <ion-button (click)="goToCreateCustomer()">
                <ion-icon slot="icon-only" name="add-circle-outline"></ion-icon>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content class="bank-gradient-bg">
    <!-- Búsqueda -->
    <div class="search-container">
        <ion-searchbar [(ngModel)]="searchTerm" (ionInput)="filterCustomers()" placeholder="Buscar cliente por nombre"
            animated></ion-searchbar>
    </div>
    <div class="bank-content-container">
        <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
            <ion-refresher-content></ion-refresher-content>
        </ion-refresher>
        <!-- Lista de Clientes -->
        <div class="bank-section">
            <div class="bank-section-header">
                <h3>Clientes Registrados</h3>
                <span class="bank-badge-primary">{{ filteredCustomers().length }} clientes</span>
            </div>
            @if (filteredCustomers().length > 0) {
            <div class="bank-simple-list">
                @for (customer of filteredCustomers(); track customer.id) {
                <div class="bank-glass-card bank-customer-item">
                    <div class="customer-main-content" (click)="goToCustomerDetail(customer.id)">
                        <div class="bank-customer-avatar">
                            <img [src]="'https://ui-avatars.com/api/?name=' + (customer.nombreCompleto || 'Cliente') + '&background=random'" [alt]="customer.nombreCompleto" />
                        </div>
                        <div class="bank-customer-info">
                            <h4 class="bank-customer-name">{{ customer.nombreCompleto || 'Sin nombre' }}</h4>
                            <p class="bank-customer-email">{{ customer.email || 'Sin correo' }}</p>
                            <div class="bank-customer-meta">
                                <span class="bank-badge" [class.bank-badge-success]="customer.estado === 'Activo'" [class.bank-badge-danger]="customer.estado !== 'Activo'">
                                    {{ customer.estado }}
                                </span>
                                <span class="bank-text-small">{{ customer.cuentasActivas || 0 }} cuentas</span>
                                @if (customer.gestorNombre) {
                                <span class="bank-text-small">• Gestor: {{ customer.gestorNombre }}</span>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="customer-actions">
                        <ion-button fill="clear" size="small" (click)="goToEditCustomer(customer.id); $event.stopPropagation()">
                            <ion-icon name="create-outline" color="primary" slot="icon-only"></ion-icon>
                        </ion-button>
                        <ion-button fill="clear" size="small" color="danger" (click)="deleteCustomer(customer); $event.stopPropagation()">
                            <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
                        </ion-button>
                    </div>
                </div>
                }
            </div>
            }

            <!-- Sin Resultados -->
            @if (filteredCustomers().length === 0 && !isLoading()) {
            <div class="bank-empty-state">
                <ion-icon name="search-outline" color="medium"></ion-icon>
                <h3>No se encontraron clientes</h3>
                <p>Intenta ajustar los criterios de búsqueda</p>
                <ion-button fill="outline" (click)="searchTerm.set(''); filterCustomers();">
                    <ion-icon name="refresh-outline" slot="start"></ion-icon>
                    Mostrar todos
                </ion-button>
            </div>
            }

            <!-- Loading -->
            @if (isLoading()) {
            <div class="bank-loading-state">
                <ion-spinner name="crescent" color="primary"></ion-spinner>
                <p>Cargando clientes...</p>
            </div>
            }
        </div>
    </div>
</ion-content>
